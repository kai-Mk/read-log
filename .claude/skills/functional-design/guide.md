# 機能設計書 記述ガイド

## 目的

PRD（プロダクト要件定義書）で定義した「何を作るか」を、「どのように作るか」に落とし込む。

## 各セクションの記述ガイド

各セクションで何をどのように記述するかを定義する。

## 1. データモデル

### 1.1 ER図

Mermaid記法でエンティティ間の関係を図示する。

- 主キー（PK）と外部キー（FK）を明示する
- リレーションのカーディナリティを示す（1対多、多対多など）
- 主要なフィールドのみ記載し、詳細は型定義を参照する

### 1.2 モデル定義

各エンティティについて、型定義とバリデーションルールをセットで記述する。

**TypeScript型定義**:
- すべてのフィールドに適切な型を指定する
- nullableなフィールドは明示的に `| null` を付ける
- enumはユニオン型で定義する
- 日付型は `Date` を使用する
- Prismaスキーマと対応させる

**バリデーションルール**:
- 必須/任意を明示する
- 文字数制限（最小/最大）を定義する
- 形式制約（ISBN形式、URL形式など）を定義する
- 数値の範囲（最小値/最大値）を定義する
- zodスキーマと対応させる

## 2. 画面仕様

### 2.1 画面一覧

すべての画面をリストアップし、以下を記述する:
- 画面名
- URLパス
- 概要

### 2.2 画面詳細

各画面について以下を記述する:
- **目的**: 画面の役割を1文で説明する
- **UI要素**: 主要なUI要素をリストアップする
- **ユーザーアクション**: アクションと結果の対応を表形式で定義する

## 3. API仕様

各エンドポイントについて以下を記述する:
- **HTTPメソッドとパス**: RESTfulな命名規則に従う
- **概要**: APIの目的を1文で説明する
- **リクエスト**: TypeScriptの型で定義する
- **レスポンス**: 成功時とエラー時の型を定義する
- **ステータスコード**: 返却される可能性のあるコードを列挙する

## 4. ユーザーフロー

Mermaid記法（flowchart）でユーザーの操作フローを図示する。

- 画面遷移を矢印で表現する
- 分岐条件を菱形ノードで示す
- 状態遷移も含める（例: 本のステータス変更）

## 5. 外部API連携

使用する外部APIについて以下を記述する:
- **用途**: なぜこのAPIを使うのかを説明する
- **エンドポイント**: URL、HTTPメソッド、パラメータを定義する
- **レスポンス**: TypeScriptの型で定義する
- **エラーケース**: 想定されるエラーと対応を列挙する

## 6. ビジネスルール

ドメインに関するルールを明確に定義する。

- 状態遷移のルール（許可される遷移、禁止される遷移）
- 自動設定のルール（条件と結果の対応）
- 制約（最大値、必須条件など）

表形式や箇条書きで明確に記述する。

## 7. エラーハンドリング

エラーケースとその対応を表形式で定義する。

- **エラーケース**: 何が起きたか
- **原因**: なぜ起きたか
- **ユーザーへの表示**: どんなメッセージを見せるか
- **対応**: システムがどう振る舞うか
